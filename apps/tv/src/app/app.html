<!-- TV Application Layout -->
<div class="tv-container">
  <!-- Navigation Bar (10%) -->
  <mat-toolbar color="primary" class="tv-nav-bar">
    <span class="header-title">ðŸ“± SAHAR TV Remote</span>
    <button mat-icon-button (click)="onHomeClick()">
      <mat-icon>home</mat-icon>
    </button>
    
    <div class="breadcrumb" *ngIf="navigation$ | async as nav">
      <span *ngFor="let crumb of nav.breadcrumb; let i = index">
        <span *ngIf="i > 0"> > </span>
        <span [class.active]="i === nav.breadcrumb.length - 1">{{ crumb }}</span>
      </span>
    </div>

    <span class="spacer"></span>

    <span class="connection-status">
      {{connectionStatus === 'connected' ? 'ðŸŸ¢ Connected' : 
        connectionStatus === 'connecting' ? 'ðŸŸ¡ Connecting...' : 'ðŸ”´ Disconnected'}}
    </span>
  </mat-toolbar>

  <!-- Main Content Area (80%) -->
  <div class="main-content">
    <!-- QR (Task 2.26): Show Remote entry URL as QR. Hidden when both TV and Remote are connected -->
    @if (!bothConnected) {
      <div class="qr-block" title="Scan to connect (opens /remote)">
        <qrcode [qrdata]="remoteUrl" [width]="96" [errorCorrectionLevel]="'M'"></qrcode>
        <div class="qr-caption">Scan to connect</div>
      </div>
    } @else {
      
      <!-- Video Player (when playing) -->
      @if (currentLevel === 'playing') {
        <div class="video-player-area" >
          <video-player
            [currentVideo]="currentVideo"
            [currentScene]="currentScene"
            [videoId]="playbackVideoId || undefined"
            [isPlaying]="playbackIsPlaying"
            [positionSec]="playbackPositionSec"
            [autoplay]="true"
            [showControls]="true"
            (playerReady)="onPlayerReady()"
            (videoStarted)="onVideoStarted()"
            (videoPaused)="onVideoPaused()"
            (videoEnded)="onVideoEnded()"
            (timeUpdate)="onTimeUpdate($event)">
          </video-player>
        </div>
      } 
      @else {
        <div class="content-with-back">
          <shared-back-card
            [enabled]="canGoBack"
            [widthPercent]="15"
            (back)="onBackClick()">
          </shared-back-card>
          <div class="data-view">
            @switch (currentLevel) {
          
            @case ('performers') {
              <shared-performers-grid            
                [performers]="currentPerformers"
                [clientType]="'tv'"
                (performerSelected)="onPerformerSelected($event)">
              </shared-performers-grid>
            }
          
            @case ('videos') {
              <shared-videos-grid
                [videos]="currentVideos"
                [clientType]="'tv'"
                [showBreadcrumb]="true"
                (videoSelected)="onVideoSelected($event)"
                (backToPerformers)="onBackToPerformers()">
              </shared-videos-grid>
            }
          
            @case ('scenes') {
              <shared-scenes-grid
                [scenes]="currentScenes"
                [clientType]="'tv'"
                [showBreadcrumb]="true"
                (sceneSelected)="onSceneSelected($event)"
                (backToVideos)="onBackToVideos()">
              </shared-scenes-grid>
            }
            }
          </div>
        </div>
      }
    }
  </div>

  <!-- Status Bar (10%) for debug -->
  <mat-toolbar class="status-bar" color="accent">
    <div *ngIf="navigation$ | async as nav">      
      <span>Items: {{ nav.currentLevel.length }}</span>
      <span class="spacer"></span>
      @if (nav.currentPerformer) {
        <span>Performer: {{ nav.currentPerformer.name }}</span>
      }
      @if (nav.currentVideo) {
        <span>Video: {{ nav.currentVideo.title }}</span>
      }
      @if (currentScene) {
        <span>Scene: {{ currentScene.title }}</span>
      }
    </div>
  </mat-toolbar>
</div>

<router-outlet />
